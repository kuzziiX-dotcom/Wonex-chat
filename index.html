<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wonex Bet | LK Premium Casino</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --cyan: #00f2ff; --blue: #0062ff; --dark: #020408; --pink: #ff0080; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--dark); color: white; overflow-x: hidden; }
        .font-tech { font-family: 'Space Grotesk', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .btn-neon { background: linear-gradient(90deg, var(--blue), var(--cyan)); transition: 0.3s; color: black; font-weight: 800; }
        .game-card { background: linear-gradient(145deg, #111827, #020408); border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; cursor: pointer; border-radius: 2rem; padding: 20px; text-align: center; }
        .game-card:hover { border-color: var(--cyan); transform: scale(1.05); }
        .hidden { display: none !important; }
        
        /* Aviator Engine */
        #aviatorZone { background: radial-gradient(circle, #1e293b 0%, #020408 100%); height: 250px; border-radius: 20px; position: relative; overflow: hidden; border: 2px solid #1e293b; }
        .plane { position: absolute; bottom: 10px; left: 10px; width: 45px; z-index: 5; }
        .trail { position: absolute; bottom: 30px; left: 30px; border-left: 2px dashed rgba(255,0,128,0.5); border-bottom: 2px dashed rgba(255,0,128,0.5); transition: 0.1s; }
        
        /* Apple Game Grid */
        .apple-box { width: 50px; height: 50px; background: #1e293b; border-radius: 8px; cursor: pointer; display: flex; items-center; justify-content: center; font-size: 20px; }
        .apple-box.active { border: 2px solid var(--cyan); }
    </style>
</head>
<body onload="initApp()">

    <!-- AUTH SECTION -->
    <section id="page-auth" class="min-h-screen flex items-center justify-center p-6 bg-[radial-gradient(circle_at_center,_#112244_0%,_transparent_100%)]">
        <div class="glass w-full max-w-md p-10 rounded-[3rem] text-center border-cyan-500/20 shadow-2xl">
            <img src="https://res.cloudinary.com/deljgkppf/image/upload/v1768149492/White_Black_Illustrative_Esport_Logo_20251230_112717_0000_zgm2cl.png" class="w-24 h-24 rounded-2xl mx-auto mb-6 shadow-lg shadow-cyan-500/20">
            <h1 class="font-tech text-3xl font-black mb-6 text-neon uppercase italic">WONEX <span class="text-white">BET</span></h1>
            <div id="authForm" class="space-y-4">
                <input type="text" id="sName" placeholder="Display Name" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white text-sm">
                <input type="email" id="sEmail" placeholder="Email Address" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white text-sm">
                <input type="password" id="sPass" placeholder="Password (Min 6)" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white text-sm">
                <div class="flex gap-2 pt-2">
                    <button onclick="handleAuth('login')" class="flex-1 py-4 border border-white/10 rounded-2xl font-bold hover:bg-white/5">Sign In</button>
                    <button onclick="handleAuth('signup')" class="flex-1 btn-neon py-4 rounded-2xl font-bold shadow-lg">Sign Up</button>
                </div>
            </div>
        </div>
    </section>

    <!-- MAIN APP -->
    <div id="main-app" class="hidden min-h-screen flex flex-col pb-20">
        <nav class="p-4 glass sticky top-0 z-50 flex justify-between items-center px-4 md:px-12 border-b border-white/5">
            <div class="flex flex-col">
                <h1 class="font-tech text-lg font-bold italic tracking-tighter uppercase">WONEX <span class="text-neon">BET</span></h1>
                <p class="text-[9px] text-cyan-400 font-bold uppercase tracking-widest">ID: <span id="displayID">--------</span></p>
            </div>
            <div class="flex items-center gap-4">
                <div class="bg-yellow-500/10 text-yellow-400 px-4 py-2 rounded-full text-sm font-black border border-yellow-500/20 shadow-lg">
                    Rs. <span id="userBalance">0.00</span>
                </div>
                <button onclick="navigateTo('wallet')" class="w-9 h-9 glass rounded-full flex items-center justify-center border-white/10 shadow-lg"><i class="fas fa-wallet text-cyan-400"></i></button>
                <button onclick="signOut()" class="text-red-500 text-sm ml-2"><i class="fas fa-power-off"></i></button>
            </div>
        </nav>

        <!-- DASHBOARD -->
        <main id="view-home" class="p-6 max-w-5xl mx-auto w-full grid grid-cols-2 gap-4">
            <div onclick="navigateTo('aviator')" class="game-card">
                <i class="fas fa-plane-departure text-4xl text-pink-500 mb-3"></i>
                <h3 class="font-tech text-xs font-bold uppercase italic">Aviator</h3>
            </div>
            <div onclick="navigateTo('apple')" class="game-card">
                <i class="fas fa-apple-alt text-4xl text-red-500 mb-3"></i>
                <h3 class="font-tech text-xs font-bold uppercase italic">Apple Fortune</h3>
            </div>
            <div onclick="navigateTo('crash')" class="game-card">
                <i class="fas fa-rocket text-4xl text-cyan-400 mb-3"></i>
                <h3 class="font-tech text-xs font-bold uppercase italic">Crash</h3>
            </div>
            <div onclick="navigateTo('mines')" class="game-card">
                <i class="fas fa-bomb text-4xl text-yellow-500 mb-3"></i>
                <h3 class="font-tech text-xs font-bold uppercase italic">Mines</h3>
            </div>
        </main>

        <!-- GAME: AVIATOR -->
        <main id="view-aviator" class="hidden p-6 max-w-xl mx-auto w-full">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 glass rounded-full"><i class="fas fa-arrow-left"></i></button>
                <h2 class="font-tech text-xl font-bold uppercase italic text-pink-500">Aviator</h2>
            </div>
            <div id="aviatorZone" class="flex flex-col items-center justify-center mb-6 shadow-2xl">
                <h2 id="multiplier" class="text-7xl font-black italic text-white z-10">1.00x</h2>
                <div id="trailLine" class="trail"></div>
                <img id="planeImg" src="https://cdn-icons-png.flaticon.com/512/723/723955.png" class="plane">
            </div>
            <div class="glass p-6 rounded-3xl space-y-4 shadow-xl">
                <input type="number" id="betAmt" placeholder="Bet Amount (Min 10)" class="w-full p-4 bg-black border border-white/10 rounded-xl text-center font-bold text-white outline-none">
                <div class="flex gap-2">
                    <button onclick="startAviator()" id="betBtn" class="flex-1 py-4 bg-green-600 rounded-xl font-black uppercase italic shadow-lg active:scale-95 transition">Bet</button>
                    <button onclick="cashOut()" id="cashBtn" class="hidden flex-1 py-4 bg-yellow-500 text-black rounded-xl font-black uppercase italic shadow-lg active:scale-95 transition">Cash Out</button>
                </div>
            </div>
        </main>

        <!-- WALLET VIEW -->
        <main id="view-wallet" class="hidden p-6 max-w-xl mx-auto w-full space-y-6 overflow-y-auto no-scrollbar">
            <div class="grid grid-cols-2 gap-4">
                <button onclick="switchWallet('dep')" class="p-4 glass rounded-2xl font-bold text-xs uppercase">Deposit</button>
                <button onclick="switchWallet('with')" class="p-4 glass rounded-2xl font-bold text-xs uppercase">Withdraw</button>
            </div>

            <!-- DEPOSIT -->
            <div id="wallet-dep" class="glass p-8 rounded-[3rem] border-yellow-500/20 shadow-2xl">
                <h3 class="text-yellow-500 font-bold uppercase mb-4 text-center italic tracking-widest text-lg">Deposit via Bank</h3>
                <div class="bg-black/60 p-5 rounded-2xl border border-white/5 mb-6 text-xs space-y-1">
                    <p>Bank: <b>BOC</b></p>
                    <p>Number: <b>95637863</b></p>
                    <p>Holder: <b>H.V.M.PEHESARA</b></p>
                    <p class="text-pink-500 font-black mt-2 uppercase">Use REF ID: <span class="idPlaceholder">--------</span></p>
                </div>
                <input type="number" id="depAmount" placeholder="Amount (LKR)" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl mb-4 text-white outline-none">
                <label class="block p-8 border-2 border-dashed border-white/10 rounded-3xl text-center cursor-pointer mb-6">
                    <input type="file" id="depSlip" class="hidden" onchange="handleSlip(this)">
                    <div id="slipStatus" class="text-[10px] uppercase font-bold opacity-40">Upload Receipt Photo</div>
                </label>
                <button onclick="submitDeposit()" class="w-full btn-neon py-4 rounded-xl font-black uppercase italic shadow-lg">Submit Request</button>
            </div>

            <!-- WITHDRAW -->
            <div id="wallet-with" class="hidden space-y-6">
                <div class="glass p-6 rounded-[2.5rem] border-white/5">
                    <h3 class="text-cyan-400 font-bold uppercase mb-6 text-center italic tracking-widest text-lg">Select Bank</h3>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div onclick="selectBank('BOC')" class="bg-white/5 p-4 rounded-xl text-center cursor-pointer border border-white/10 hover:border-cyan-400">
                            <img src="https://upload.wikimedia.org/wikipedia/en/thumb/5/52/Bank_of_Ceylon_logo.svg/1200px-Bank_of_Ceylon_logo.svg.png" class="h-8 mx-auto mb-2">
                            <p class="text-[8px] font-bold">BOC</p>
                        </div>
                        <div onclick="selectBank('Sampath')" class="bg-white/5 p-4 rounded-xl text-center cursor-pointer border border-white/10 hover:border-cyan-400">
                            <img src="https://www.sampath.lk/assets/images/logo.png" class="h-8 mx-auto mb-2">
                            <p class="text-[8px] font-bold">Sampath Bank</p>
                        </div>
                        <div onclick="selectBank('HNB')" class="bg-white/5 p-4 rounded-xl text-center cursor-pointer border border-white/10 hover:border-cyan-400">
                            <img src="https://upload.wikimedia.org/wikipedia/en/2/23/Hatton_National_Bank_logo.png" class="h-8 mx-auto mb-2">
                            <p class="text-[8px] font-bold">HNB</p>
                        </div>
                        <div onclick="selectBank('Commercial')" class="bg-white/5 p-4 rounded-xl text-center cursor-pointer border border-white/10 hover:border-cyan-400">
                            <img src="https://www.combank.lk/assets/images/logo.png" class="h-8 mx-auto mb-2">
                            <p class="text-[8px] font-bold">Commercial Bank</p>
                        </div>
                    </div>

                    <div id="withForm" class="space-y-4">
                        <input type="text" id="bankHolder" placeholder="Cardholder Name" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-sm">
                        <input type="text" id="bankNum" placeholder="Account Number" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-sm">
                        <input type="text" id="bankBranch" placeholder="Branch Name" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-sm">
                        <input type="number" id="withAmount" placeholder="Amount (Min 500 - Max 60000)" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-sm">
                        <button onclick="submitWithdraw()" class="w-full bg-pink-600 py-4 rounded-xl font-black uppercase italic shadow-lg">Confirm Withdrawal</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCM3yb5BHgouL7jDpiIv10D8PF0Gzpirwo",
            authDomain: "wonex-bet.firebaseapp.com",
            databaseURL: "https://wonex-bet-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "wonex-bet",
            storageBucket: "wonex-bet.firebasestorage.app",
            messagingSenderId: "824654362902",
            appId: "1:824654362902:web:52d7b27c33cdce7f40f837",
            measurementId: "G-RWWTL58P4X"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let currentUser = null, userBalance = 0, userID = "", selBank = "", slipBase64 = "";

        function initApp() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    database.ref('wonex_users/' + user.uid).on('value', snap => {
                        const data = snap.val();
                        if(data) {
                            userBalance = data.balance || 0;
                            userID = data.id;
                            document.getElementById('userBalance').innerText = userBalance.toFixed(2);
                            document.getElementById('displayID').innerText = userID;
                            document.querySelectorAll('.idPlaceholder').forEach(el => el.innerText = userID);
                            showMain();
                        } else {
                            handleNewUser(user);
                        }
                    });
                } else {
                    document.getElementById('page-auth').classList.remove('hidden');
                    document.getElementById('main-app').classList.add('hidden');
                }
            });
        }

        async function handleNewUser(user) {
            const idRef = database.ref('global/nextID');
            const snap = await idRef.transaction(current => (current || 10000000) + 1);
            const newID = snap.snapshot.val();
            await database.ref('wonex_users/' + user.uid).set({
                name: document.getElementById('sName').value || 'Elite Gamer',
                email: user.email, id: newID, balance: 100.00, regDate: Date.now()
            });
            alert("Rs. 100/- Signup Bonus added!");
        }

        async function handleAuth(mode) {
            const email = document.getElementById('sEmail').value;
            const pass = document.getElementById('sPass').value;
            try {
                if(mode === 'signup') await auth.createUserWithEmailAndPassword(email, pass);
                else await auth.signInWithEmailAndPassword(email, pass);
            } catch (err) { alert(err.message); }
        }

        // --- GAME: AVIATOR ---
        let aviActive = false, aviMult = 1.0, aviCrash = 0, aviTimer = null;
        function startAviator() {
            const bet = parseFloat(document.getElementById('betAmt').value);
            if(bet > userBalance || bet < 10) return alert("Low balance or Min Rs. 10");
            aviActive = true; aviMult = 1.0; aviCrash = (Math.random() * 4.5 + 1.1).toFixed(2);
            database.ref('wonex_users/'+currentUser.uid).update({ balance: userBalance - bet });
            document.getElementById('betBtn').classList.add('hidden');
            document.getElementById('cashBtn').classList.remove('hidden');
            aviTimer = setInterval(() => {
                aviMult += 0.04;
                document.getElementById('multiplier').innerText = aviMult.toFixed(2) + "x";
                document.getElementById('planeImg').style.bottom = (aviMult * 20) + "px";
                document.getElementById('planeImg').style.left = (aviMult * 30) + "px";
                if(aviMult >= aviCrash) stopAviator(false, bet);
            }, 100);
        }

        function cashOut() { if(aviActive) stopAviator(true, parseFloat(document.getElementById('betAmt').value)); }

        async function stopAviator(win, bet) {
            aviActive = false; clearInterval(aviTimer);
            document.getElementById('betBtn').classList.remove('hidden');
            document.getElementById('cashBtn').classList.add('hidden');
            if(win) {
                const prize = bet * aviMult;
                await database.ref('wonex_users/'+currentUser.uid).update({ balance: userBalance + prize });
                alert("WIN! Rs. " + prize.toFixed(2));
            } else {
                document.getElementById('multiplier').innerText = "FLEW AWAY!";
                setTimeout(() => { 
                    document.getElementById('multiplier').innerText = "1.00x";
                    document.getElementById('planeImg').style.bottom = "10px";
                    document.getElementById('planeImg').style.left = "10px";
                }, 2000);
            }
        }

        // --- WALLET ---
        function handleSlip(i) {
            const reader = new FileReader(); reader.onload = e => {
                slipBase64 = e.target.result;
                document.getElementById('slipStatus').innerText = "Slip Uploaded âœ…";
            };
            reader.readAsDataURL(i.files[0]);
        }

        async function submitDeposit() {
            const amt = document.getElementById('depAmount').value;
            if(!amt || !slipBase64) return alert("Fill Amount & Upload Slip!");
            await database.ref('deposits').push({ uid: currentUser.uid, id: userID, amount: amt, slip: slipBase64, status: 'Pending', time: Date.now() });
            alert("Submitted! Admin will verify soon.");
        }

        function selectBank(b) { selBank = b; alert("Bank Selected: " + b); }

        async function submitWithdraw() {
            const amt = parseFloat(document.getElementById('withAmount').value);
            if(amt < 500 || amt > 60000 || userBalance < amt) return alert("Error: Min 500, Max 60000 or Low Balance.");
            const details = `Bank: ${selBank}, Holder: ${document.getElementById('bankHolder').value}, Acc: ${document.getElementById('bankNum').value}, Branch: ${document.getElementById('bankBranch').value}`;
            await database.ref('withdrawals').push({ uid: currentUser.uid, id: userID, amount: amt, details, status: 'Pending', time: Date.now() });
            await database.ref('wonex_users/'+currentUser.uid).update({ balance: userBalance - amt });
            alert("Withdrawal Requested! Processing to Bank...");
        }

        function navigateTo(v) { ['home', 'aviator', 'wallet', 'profile'].forEach(id => document.getElementById('view-'+id)?.classList.add('hidden')); document.getElementById('view-'+v).classList.remove('hidden'); }
        function switchWallet(t) { document.getElementById('wallet-dep').classList.toggle('hidden', t !== 'dep'); document.getElementById('wallet-with').classList.toggle('hidden', t !== 'with'); }
        function showMain() { document.getElementById('page-auth').classList.add('hidden'); document.getElementById('main-app').classList.remove('hidden'); }
        function signOut() { auth.signOut().then(() => location.reload()); }
        function toggleTab(m) { document.getElementById('signupForm').classList.toggle('hidden', m === 'login'); document.getElementById('loginForm').classList.toggle('hidden', m === 'signup'); }
    </script>
</body>
</html>
