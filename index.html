<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wonex Digital | Wallet & Games</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --cyan: #00f2ff; --blue: #0062ff; --dark: #020408; --gold: #ffd700; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--dark); color: white; overflow-x: hidden; }
        .font-tech { font-family: 'Space Grotesk', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .text-neon { color: var(--cyan); text-shadow: 0 0 15px rgba(0, 242, 255, 0.5); }
        .btn-neon { background: linear-gradient(90deg, var(--blue), var(--cyan)); transition: 0.3s; color: black; font-weight: 800; }
        .btn-neon:hover { box-shadow: 0 0 25px var(--cyan); transform: translateY(-2px); }
        .hidden { display: none !important; }
        #wheel { width: 280px; height: 280px; border-radius: 50%; border: 10px solid #1e293b; position: relative; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }
        .wheel-pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #ff0080; z-index: 10; }
    </style>
</head>
<body onload="initApp()">

    <!-- AUTH SECTION -->
    <section id="page-auth" class="min-h-screen flex items-center justify-center p-6 bg-[radial-gradient(circle_at_center,_#112244_0%,_transparent_100%)]">
        <div class="glass w-full max-w-md p-10 rounded-[3rem] text-center border-cyan-500/20 shadow-2xl">
            <img src="https://res.cloudinary.com/deljgkppf/image/upload/v1768149492/White_Black_Illustrative_Esport_Logo_20251230_112717_0000_zgm2cl.png" class="w-24 h-24 rounded-2xl mx-auto mb-6 shadow-lg shadow-cyan-500/20">
            <h1 class="font-tech text-3xl font-black mb-2 uppercase italic tracking-tighter">WONEX <span class="text-neon">WALLET</span></h1>
            
            <div class="flex mb-8 bg-white/5 rounded-2xl p-1 mt-6">
                <button id="signupTab" onclick="toggleTab('signup')" class="flex-1 py-3 text-xs font-bold rounded-xl btn-neon transition uppercase">Register</button>
                <button id="loginTab" onclick="toggleTab('login')" class="flex-1 py-3 text-xs font-bold rounded-xl transition uppercase">Login</button>
            </div>

            <div id="signupForm" class="space-y-4">
                <input type="text" id="sName" placeholder="Full Name" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none focus:border-cyan-400 text-sm">
                <input type="email" id="sEmail" placeholder="Email Address" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none focus:border-cyan-400 text-sm">
                <input type="password" id="sPass" placeholder="Password" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none focus:border-cyan-400 text-sm">
                <button onclick="handleAuth('signup')" class="w-full btn-neon py-4 rounded-2xl font-black uppercase shadow-xl">Join Now</button>
            </div>

            <div id="loginForm" class="space-y-4 hidden">
                <input type="email" id="lEmail" placeholder="Email Address" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none focus:border-cyan-400 text-sm">
                <input type="password" id="lPass" placeholder="Password" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none focus:border-cyan-400 text-sm">
                <button onclick="handleAuth('login')" class="w-full btn-neon py-4 rounded-2xl font-black uppercase shadow-xl">Sign In</button>
            </div>
        </div>
    </section>

    <!-- MAIN APP -->
    <div id="main-app" class="hidden min-h-screen flex flex-col pb-20">
        <nav class="p-4 glass sticky top-0 z-50 flex justify-between items-center px-4 md:px-12 border-b border-white/5">
            <h1 class="font-tech text-xl font-bold italic">WONEX <span class="text-neon">DIGITAL</span></h1>
            <div class="flex items-center gap-3">
                <div class="bg-cyan-500/10 text-cyan-400 px-4 py-1.5 rounded-full text-[11px] font-black border border-cyan-500/20">
                    Rs. <span id="userBalance">0.00</span>
                </div>
                <div onclick="navigateTo('wallet')" class="w-9 h-9 glass rounded-full flex items-center justify-center cursor-pointer"><i class="fas fa-wallet text-cyan-400"></i></div>
                <button onclick="signOut()" class="text-red-500 text-xs"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </nav>

        <!-- DASHBOARD / GAMES -->
        <main id="view-home" class="p-6 max-w-4xl mx-auto w-full space-y-10">
            <div class="text-center py-6">
                <h2 class="text-3xl font-black text-pink-500 italic uppercase italic">Lucky Win Wheel</h2>
                <p class="text-[10px] text-gray-500 uppercase tracking-widest mt-2">Spin cost: Rs. 20.00</p>
            </div>

            <div class="relative flex justify-center mb-10">
                <div class="wheel-pointer"></div>
                <div id="wheel" style="background: conic-gradient(#ff0080 0deg 45deg, #00f2ff 45deg 90deg, #ffd700 90deg 135deg, #0062ff 135deg 180deg, #ff0080 180deg 225deg, #00f2ff 225deg 270deg, #ffd700 270deg 315deg, #0062ff 315deg 360deg);">
                    <div class="absolute inset-0 flex items-center justify-center font-black text-black text-[10px]">
                        <span class="rotate-[22deg] absolute translate-y-[-90px]">Rs.10</span>
                        <span class="rotate-[67deg] absolute translate-y-[-90px]">Rs.50</span>
                        <span class="rotate-[112deg] absolute translate-y-[-90px]">Rs.0</span>
                        <span class="rotate-[157deg] absolute translate-y-[-90px]">Rs.100</span>
                    </div>
                </div>
            </div>

            <button onclick="spinWheel()" id="spinBtn" class="w-full max-w-sm mx-auto block btn-neon py-5 rounded-full font-black uppercase tracking-widest shadow-2xl">Spin & Win Now</button>
            
            <div class="bg-white/5 p-6 rounded-3xl border border-white/5 text-center">
                <div class="flex justify-around">
                    <div><p id="liveCounter" class="text-xl font-black text-cyan-400">1</p><p class="text-[8px] uppercase tracking-widest">Active Players</p></div>
                    <div><p class="text-xl font-black text-green-400">Rs. 2,500+</p><p class="text-[8px] uppercase tracking-widest">Total Paid</p></div>
                </div>
            </div>
        </main>

        <!-- WALLET VIEW -->
        <main id="view-wallet" class="hidden p-6 max-w-2xl mx-auto w-full space-y-8">
            <div class="grid grid-cols-2 gap-4">
                <button onclick="toggleWalletTab('dep')" class="p-4 glass rounded-2xl font-bold uppercase text-xs">Deposit</button>
                <button onclick="toggleWalletTab('with')" class="p-4 glass rounded-2xl font-bold uppercase text-xs">Withdraw</button>
            </div>

            <!-- Deposit UI -->
            <div id="depSection" class="space-y-6">
                <div class="glass p-8 rounded-[3rem] border-yellow-500/20">
                    <h3 class="text-yellow-500 font-bold uppercase mb-4 text-center">Add Funds (BOC)</h3>
                    <div class="bg-black p-5 rounded-2xl mb-6 text-xs border border-white/5">
                        <p>Number: <b>95637863</b></p>
                        <p>Name: <b>H.V.M.PEHESARA</b></p>
                    </div>
                    <input type="number" id="depAmount" placeholder="Amount (Rs)" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl mb-4 text-sm">
                    <label class="block p-8 border-2 border-dashed border-white/10 rounded-2xl text-center cursor-pointer mb-6">
                        <input type="file" id="depSlip" class="hidden" onchange="handleSlip(this)">
                        <div id="slipName" class="text-[10px] uppercase opacity-50">Upload Payment Slip</div>
                    </label>
                    <button onclick="submitDeposit()" class="w-full btn-neon py-4 rounded-xl font-black uppercase text-xs">Submit Deposit</button>
                </div>
            </div>

            <!-- Withdraw UI -->
            <div id="withSection" class="hidden space-y-6">
                <div class="glass p-8 rounded-[3rem] border-pink-500/20">
                    <h3 class="text-pink-500 font-bold uppercase mb-4 text-center">Cashout Money</h3>
                    <input type="number" id="withAmount" placeholder="Amount (Min Rs.500)" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl mb-4 text-sm">
                    <textarea id="withDetails" placeholder="Bank Name, Acc Number, Branch & Your Name" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl mb-6 text-sm" rows="3"></textarea>
                    <button onclick="submitWithdraw()" class="w-full btn-neon py-4 rounded-xl font-black uppercase text-xs">Request Cashout</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAHP6jCiOZ3yBTMogJ-8lGWb26U_SfeXts",
            authDomain: "lochi-creation-bc929.firebaseapp.com",
            databaseURL: "https://wonexai-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "lochi-creation-bc929",
            storageBucket: "lochi-creation-bc929.firebasestorage.app",
            messagingSenderId: "636349455142",
            appId: "1:636349455142:web:01964aef83ad25fb59ffe7"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let currentUid = null, balance = 0, slipBase64 = "";

        function initApp() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUid = user.uid;
                    database.ref('wonex_users/' + user.uid).on('value', s => {
                        const data = s.val();
                        if(data) {
                            balance = data.balance || 0;
                            document.getElementById('userBalance').innerText = balance.toFixed(2);
                            showMain();
                            trackPresence();
                        } else {
                            database.ref('wonex_users/'+user.uid).set({ name: user.displayName || 'Gamer', balance: 0 });
                        }
                    });
                } else {
                    document.getElementById('page-auth').classList.remove('hidden');
                    document.getElementById('main-app').classList.add('hidden');
                }
            });
        }

        async function handleAuth(mode) {
            const email = document.getElementById(mode === 'signup' ? 'sEmail' : 'lEmail').value;
            const pass = document.getElementById(mode === 'signup' ? 'sPass' : 'lPass').value;
            try {
                if(mode === 'signup') {
                    const name = document.getElementById('sName').value;
                    const res = await auth.createUserWithEmailAndPassword(email, pass);
                    await database.ref('wonex_users/' + res.user.uid).set({ name, email, balance: 0 });
                } else { await auth.signInWithEmailAndPassword(email, pass); }
            } catch (err) { alert(err.message); }
        }

        function spinWheel() {
            if(balance < 20) return alert("Min Rs. 20 required!");
            database.ref('wonex_users/'+currentUid).update({ balance: balance - 20 });
            
            const deg = 3600 + Math.floor(Math.random() * 3600);
            document.getElementById('wheel').style.transform = `rotate(${deg}deg)`;

            setTimeout(async () => {
                const actualDeg = deg % 360;
                let win = 0;
                if(actualDeg >= 0 && actualDeg < 45) win = 10;
                else if(actualDeg >= 45 && actualDeg < 90) win = 50;
                else if(actualDeg >= 135 && actualDeg < 180) win = 100;
                
                await database.ref('wonex_users/'+currentUid).update({ balance: balance + win });
                alert(win > 0 ? `YOU WON RS. ${win}!` : "TRY AGAIN!");
            }, 4000);
        }

        function handleSlip(i) {
            const r = new FileReader(); r.onload = e => {
                slipBase64 = e.target.result;
                document.getElementById('slipName').innerText = "Slip Selected âœ…";
            };
            r.readAsDataURL(i.files[0]);
        }

        async function submitDeposit() {
            const amt = document.getElementById('depAmount').value;
            if(!amt || !slipBase64) return alert("Amount and Slip required!");
            await database.ref('deposits').push({ uid: currentUid, name: auth.currentUser.email, amount: parseFloat(amt), slip: slipBase64, status: 'Pending', time: Date.now() });
            alert("Deposit Submitted! Admin will verify soon.");
            location.reload();
        }

        async function submitWithdraw() {
            const amt = document.getElementById('withAmount').value;
            const det = document.getElementById('withDetails').value;
            if(amt < 500 || balance < amt) return alert("Check balance or amount (Min 500)!");
            await database.ref('withdrawals').push({ uid: currentUid, amount: parseFloat(amt), details: det, status: 'Pending', time: Date.now() });
            await database.ref('wonex_users/'+currentUid).update({ balance: balance - parseFloat(amt) });
            alert("Withdrawal Requested!");
        }

        function toggleWalletTab(t) {
            document.getElementById('depSection').classList.toggle('hidden', t !== 'dep');
            document.getElementById('withSection').classList.toggle('hidden', t !== 'with');
        }
        function navigateTo(v) { ['home', 'wallet', 'profile'].forEach(id => document.getElementById('view-'+id).classList.add('hidden')); document.getElementById('view-'+v).classList.remove('hidden'); }
        function trackPresence() { const r = database.ref('presence').push(true); r.onDisconnect().remove(); database.ref('presence').on('value', s => document.getElementById('liveCounter').innerText = s.numChildren()); }
        function showMain() { document.getElementById('page-auth').classList.add('hidden'); document.getElementById('main-app').classList.remove('hidden'); }
        function signOut() { auth.signOut().then(() => location.reload()); }
    </script>
</body>
</html>
